<Window x:Class="SysPilot.Controls.RunDialog"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:iconPacks="http://metro.mahapps.com/winfx/xaml/iconpacks"
        xmlns:local="clr-namespace:SysPilot"
        Title="{x:Static local:Lang.Run}"
        WindowStyle="None"
        AllowsTransparency="True"
        Background="Transparent"
        WindowStartupLocation="CenterOwner"
        ResizeMode="NoResize"
        ShowInTaskbar="False"
        Width="400"
        SizeToContent="Height">

    <Border Background="#252525"
            CornerRadius="12"
            Padding="20"
            Margin="20">
        <Border.Effect>
            <DropShadowEffect BlurRadius="20" ShadowDepth="0" Opacity="0.5"/>
        </Border.Effect>

        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- Title -->
            <TextBlock Grid.Row="0"
                       Text="{x:Static local:Lang.Run}"
                       Foreground="#E0E0E0"
                       FontSize="14"
                       FontWeight="SemiBold"
                       Margin="0,0,0,12"/>

            <!-- Command Input with Autocomplete -->
            <Grid Grid.Row="1" Margin="0,0,0,8">
                <Border x:Name="InputBorder" Background="#1E1E1E" CornerRadius="6" Padding="10,8">
                    <TextBox x:Name="CommandInput"
                             Background="Transparent"
                             Foreground="#E0E0E0"
                             BorderThickness="0"
                             CaretBrush="#E0E0E0"
                             FontSize="13"
                             VerticalAlignment="Center"
                             TextChanged="CommandInput_TextChanged"
                             PreviewKeyDown="CommandInput_PreviewKeyDown"/>
                </Border>

                <!-- Autocomplete Popup -->
                <Popup x:Name="AutocompletePopup"
                       PlacementTarget="{Binding ElementName=InputBorder}"
                       Placement="Bottom"
                       StaysOpen="False"
                       AllowsTransparency="True"
                       PopupAnimation="Fade">
                    <Border Background="#1E1E1E" CornerRadius="6"
                            BorderBrush="#3A3A3A" BorderThickness="1"
                            MaxHeight="200"
                            Width="{Binding ActualWidth, ElementName=InputBorder}">
                        <Border.Effect>
                            <DropShadowEffect BlurRadius="10" ShadowDepth="2" Opacity="0.3"/>
                        </Border.Effect>
                        <ListBox x:Name="SuggestionsList"
                                 Background="Transparent"
                                 BorderThickness="0"
                                 ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                                 PreviewMouseLeftButtonUp="SuggestionsList_Click">
                            <ListBox.ItemTemplate>
                                <DataTemplate>
                                    <StackPanel Orientation="Horizontal" Margin="6,4">
                                        <Image Source="{Binding Icon}" Width="16" Height="16"
                                               RenderOptions.BitmapScalingMode="HighQuality"
                                               VerticalAlignment="Center"/>
                                        <TextBlock Text="{Binding Name}"
                                                   Foreground="#E0E0E0"
                                                   FontSize="12"
                                                   Margin="8,0,0,0"
                                                   VerticalAlignment="Center"
                                                   TextTrimming="CharacterEllipsis"/>
                                    </StackPanel>
                                </DataTemplate>
                            </ListBox.ItemTemplate>
                            <ListBox.ItemContainerStyle>
                                <Style TargetType="ListBoxItem">
                                    <Setter Property="Padding" Value="0"/>
                                    <Setter Property="Margin" Value="0"/>
                                    <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
                                    <Setter Property="Template">
                                        <Setter.Value>
                                            <ControlTemplate TargetType="ListBoxItem">
                                                <Border x:Name="Bd" Background="Transparent" Padding="4,2">
                                                    <ContentPresenter/>
                                                </Border>
                                                <ControlTemplate.Triggers>
                                                    <Trigger Property="IsMouseOver" Value="True">
                                                        <Setter TargetName="Bd" Property="Background" Value="#2A2A2A"/>
                                                    </Trigger>
                                                    <Trigger Property="IsSelected" Value="True">
                                                        <Setter TargetName="Bd" Property="Background" Value="#3A3A3A"/>
                                                    </Trigger>
                                                </ControlTemplate.Triggers>
                                            </ControlTemplate>
                                        </Setter.Value>
                                    </Setter>
                                </Style>
                            </ListBox.ItemContainerStyle>
                        </ListBox>
                    </Border>
                </Popup>
            </Grid>

            <!-- Run as Admin -->
            <CheckBox x:Name="RunAsAdminCheck" Grid.Row="2" Margin="0,4,0,16" Cursor="Hand">
                <CheckBox.Template>
                    <ControlTemplate TargetType="CheckBox">
                        <StackPanel Orientation="Horizontal">
                            <Border x:Name="box" Width="16" Height="16" Background="#1E1E1E"
                                    CornerRadius="3" BorderBrush="#3A3A3A" BorderThickness="1">
                                <iconPacks:PackIconMaterial x:Name="check" Kind="Check" Width="10" Height="10"
                                                            Foreground="#007ACC" HorizontalAlignment="Center"
                                                            VerticalAlignment="Center" Visibility="Collapsed"/>
                            </Border>
                            <iconPacks:PackIconMaterial Kind="Shield" Width="12" Height="12"
                                                        Foreground="#F0C030" Margin="8,0,0,0" VerticalAlignment="Center"/>
                            <TextBlock Text="{x:Static local:Lang.RunAsAdministrator}" Foreground="#909090" FontSize="12"
                                       Margin="4,0,0,0" VerticalAlignment="Center"/>
                        </StackPanel>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsChecked" Value="True">
                                <Setter TargetName="check" Property="Visibility" Value="Visible"/>
                                <Setter TargetName="box" Property="BorderBrush" Value="#007ACC"/>
                            </Trigger>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="box" Property="Background" Value="#2A2A2A"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </CheckBox.Template>
            </CheckBox>

            <!-- Buttons -->
            <StackPanel Grid.Row="3" Orientation="Horizontal" HorizontalAlignment="Right">
                <Button Content="{x:Static local:Lang.Cancel}" Click="Cancel_Click"
                        Background="Transparent" Foreground="#909090" BorderThickness="0"
                        Padding="12,6" Cursor="Hand" FontSize="12">
                    <Button.Template>
                        <ControlTemplate TargetType="Button">
                            <Border x:Name="bd" Background="{TemplateBinding Background}"
                                    CornerRadius="4" Padding="{TemplateBinding Padding}">
                                <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                            </Border>
                            <ControlTemplate.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter TargetName="bd" Property="Background" Value="#2A2A2A"/>
                                </Trigger>
                            </ControlTemplate.Triggers>
                        </ControlTemplate>
                    </Button.Template>
                </Button>
                <Button Content="{x:Static local:Lang.Run}" Click="Run_Click"
                        Background="#007ACC" Foreground="#FFFFFF" BorderThickness="0"
                        Padding="16,6" Cursor="Hand" FontSize="12" Margin="8,0,0,0">
                    <Button.Template>
                        <ControlTemplate TargetType="Button">
                            <Border x:Name="bd" Background="{TemplateBinding Background}"
                                    CornerRadius="4" Padding="{TemplateBinding Padding}">
                                <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                            </Border>
                            <ControlTemplate.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter TargetName="bd" Property="Background" Value="#1E8AD2"/>
                                </Trigger>
                            </ControlTemplate.Triggers>
                        </ControlTemplate>
                    </Button.Template>
                </Button>
            </StackPanel>
        </Grid>
    </Border>
</Window>
